#
# @TITLE@ - @DESCR@
#

.POSIX:

NAME		= @NAME@
PKG_NAME	= @PKG_NAME@
VERSION		= @VERSION@
INIT		= @INIT@
FOR_WHAT	= @FOR_WHAT@

srcdir		= @srcdir@
asrcdir		= @asrcdir@
cwd		= @cwd@

prefix		= @prefix@
appdir		= @appdir@
pkgdir		= @pkgdir@
moddir		= @moddir@
mandir		= @mandir@
docdir		= @docdir@
exadir		= @exadir@
datdir		= @datdir@
bindir		= @bindir@

VPATH		= @VPATH@

CC		= @CC@
CFLAGS_CC	= @CFLAGS_CC@
CFLAGS_WARN	= @CFLAGS_WARN@
CFLAGS_OPT	= @CFLAGS_OPT@
CFLAGS_SH	= @CFLAGS_SH@
CFLAGS_TH	= @CFLAGS_TH@
LIBS_TH		= @LIBS_TH@
DEFS_TH		= @DEFS_TH@
DEFS_OPT	= @DEFS_OPT@
LDFLAGS		= @LDFLAGS@
LDFLAGS_SH	= @LDFLAGS_SH@
DEFS_TCL	= @DEFS_TCL@
DEFS_JIM	= @DEFS_JIM@
DEFS		= @DEFS@
DEFS_SPOT	= @DEFS_SPOT@ -DFOR_WHAT=\"${FOR_WHAT}\"
EXT_DEFS	= @EXT_DEFS@
EXT_INC_SPEC	= @EXT_INC_SPEC@
EXT_LIB_SPEC	= @EXT_LIB_SPEC@
TCL_INC_SPEC	= @TCL_INC_SPEC@
JIM_INC_SPEC	= @JIM_INC_SPEC@
TCL_LIB_SPEC	= @TCL_LIB_SPEC@
JIM_LIB_SPEC	= @JIM_LIB_SPEC@
TCL_STUB_LIB_SPEC = @TCL_STUB_LIB_SPEC@

CC_INC_SPEC	= @CC_INC_SPEC@
LD_LIB_SPEC	= @LD_LIB_SPEC@
INC_SPEC	= ${EXT_INC_SPEC} ${CC_INC_SPEC}
LIB_SPEC	= ${EXT_LIB_SPEC} ${LD_LIB_SPEC}

CFLAGS_DEBUG	= @CFLAGS_DEBUG@

SRC		= ${NAME}.c
OBJ		= ${NAME}.o
LIB		= @LIB@
SHLIB		= @SHLIB@
SCLIB		= @LIBDIR@@SCLIB@
SCLIBSRC	= @SCLIBSRC@
LIBDIR		= @LIBDIR@
DOC		= @DOC@
DOCSRC		= @DOCSRC@
DOCBLD		= @DOCBLD@
DOCFMT		= @DOCFMT@
SCBIN		= @SCBIN@
SCBINSRC	= @SCBINSRC@
PKGINDEX	= @PKGINDEX@

EXT_DEP_FILES	= @EXT_DEP_FILES@
EXT_BUILD 	= @EXT_BUILD@

DAT_DIR		= @DAT_DIR@
DAT_FILES	= @DAT_FILES@

PKGS		= @PKGS@
PKGS_DIR	= @PKGS_DIR@

BJE		= @BJE@
SH		= @SH@
TCL_PKG_ENV	= @LD_LIBRARY_PATH_VAR@=".:$(@LD_LIBRARY_PATH_VAR@)" TCLLIBPATH="@TCLLIBPATH@" TCL8_5_TM_PATH='@TCL8_5_TM_PATH@' TCL8_6_TM_PATH='@TCL8_6_TM_PATH@'
JIM_PKG_ENV	= JIMLIB="@JIMLIB@"
TCLSH_PROG	= @TCLSH_PROG@
TCLSH		= $(TCL_PKG_ENV) ${TCLSH_PROG}
JIMSH_PROG	= @JIMSH_PROG@
JIMSH		= $(JIM_PKG_ENV) ${JIMSH_PROG}
SCRIPT		=

TESTENV		= @TESTENV@
TESTFWK		= @TESTFWK@
TESTFLAGS	=

DAT_MODE	= 644
BIN_MODE	= 755
DESTDIR		=
INSTALL_OPTIONS	=
INSTALL		= ${SH} ${srcdir}/tclconfig/install-sh -c $(INSTALL_OPTIONS)
INSTALL_DATA_DIR = $(INSTALL) -d -m 755
INSTALL_PROGRAM	= $(INSTALL) -m $(BIN_MODE)
INSTALL_DATA	= $(INSTALL) -m $(DAT_MODE)
INSTALL_SCRIPT	= $(INSTALL) -m $(BIN_MODE)
INSTALL_LIBRARY	= $(INSTALL) -m $(DAT_MODE)

PKG_INSTALL_DIR	= @PKG_INSTALL_DIR@
DOC_INSTALL_DIR	= @DOC_INSTALL_DIR@

INDENT		= "    "

DIST_NAME	= @DIST_NAME@
DIST_ROOT	= /tmp/dist
DIST_DIR	= $(DIST_ROOT)/$(DIST_NAME)
DIST_FILE	= $(DIST_NAME).tar.gz
DIST_INSTALL_DATA   = CPPROG='cp -p' $(INSTALL) -m 644
DIST_INSTALL_SCRIPT = CPPROG='cp -p' $(INSTALL) -m 755

SPOTO_ARGS	= @SPOTO_ARGS@
P		= printf
EN		= $(P) %s
E		= $(EN)'\n'

.SUFFIXES: .man .html .n .1

.man.html .man.n .man.1:
	${DOCBLD} -o $@ ${DOCFMT} $<

all: ${LIBDIR} ${SHLIB} ${SCLIB} ${PKGINDEX} ${DOC} ${SCBIN} ${EXT_BUILD}

$(OBJ): $(SRC) ${EXT_DEP_FILES}
	${CC} \
	-c \
	${CFLAGS_CC} \
	${CFLAGS_WARN} \
	${CFLAGS_TH} \
	${CFLAGS_SH} \
	${CFLAGS_OPT} \
	${CFLAGS_DEBUG} \
	${DEFS} \
	${DEFS_TH} \
	${DEFS_OPT} \
	${EXT_DEFS} \
	${DEFS_SPOT} \
	$(INC_SPEC) \
	-o $@ $<

${SHLIB}: $(OBJ)
	${CC} \
	${CFLAGS_CC} \
	${CFLAGS_SH} \
	${CFLAGS_WARN} \
	${CFLAGS_OPT} \
	${LDFLAGS} \
	${LDFLAGS_SH} \
	-o $@ \
	$(OBJ) \
	${LIBS_TH} \
	$(LIB_SPEC)

bje:
	${BJE} --keep --notest ${DEFS} ${DEFS_OPT} -o ${PKG_NAME} ${srcdir}/generic/$(SRC)

${LIBDIR}: ${LIBDIR}
	$(INSTALL_DATA_DIR) ${LIBDIR}

${SCLIB}: ${SCLIBSRC}
	@BUILD_SCLIB@

${SCBIN}: ${SCBINSRC}
	@BUILD_SCBIN@

${DOC}: ${srcdir}/doc/${DOC}
	@BUILD_DOC@

pkgIndex.tcl:
	$(E) 'package ifneeded ${PKG_NAME} ${VERSION} [list @LOAD_LIB@ [file join $$dir ${LIB}] ${INIT}]' > pkgIndex.tcl

result:
	${SH} ${srcdir}/configure --result

thatch:
	${SH} ${srcdir}/thatch/mkthatch
	chmod $(BIN_MODE) ${NAME}-${VERSION}.tcl

reconfigure:
	${SH} ${srcdir}/configure ${SPOTO_ARGS} --pkgs-cfgnow=no

configure:
	@if ! test -f spoto.sed; then \
	    make reconfigure; \
	else \
	    : $(E) "${NAME} already configured. Try reconfigure."; \
	fi

clean-:

clean-pkgIndex.tcl:
	rm -f @PKGINDEX@

clean-cfg_pkgIndex.tcl:
	rm -f pkgIndex.tcl

clean-doc:
	if test X"${DOC}" != X"" && test -h "${DOC}" ; then \
	    rm -f "${DOC}" ; \
	fi

clean-spot: clean-@PKGINDEX@ clean-doc
	rm -f ${SHLIB} ${OBJ} *.core
	if test X"${SCLIB}" != X"" && test -h "${SCLIB}" ; then \
	    rm -f "${SCLIB}" ; \
	fi
	if test X"${SCBIN}" != X"" && test -h "${SCBIN}" ; then \
	    rm -f "${SCBIN}" ; \
	fi
	if test X"${LIBDIR}" != X"" && test -d "${LIBDIR}" ; then \
	    rmdir -p "${LIBDIR}" ; \
	fi

distclean-spot: clean clean-@CFG_PKGINDEX@
	rm -f Makefile spoto.sed

clean: @CLEAN@

distclean: @DISTCLEAN@

shell-Tcl: all
	$(TCLSH) $(SCRIPT)

shell-Jim: all
	$(JIMSH) $(SCRIPT)

shell-spot: shell-@FOR_WHAT@

shell: @SHELL@

test-Tcl: all
	${TESTENV} $(TCLSH) ${srcdir}/tests/${TESTFWK} $(TESTFLAGS)

test-Jim: all
	for p in ${srcdir}/tests/*.test; do ${TESTENV} $(JIMSH) $$p $(TESTFLAGS); done

test-spot: test-@FOR_WHAT@

no-test:
	@$(E) "This software has no tests! Maybe it should? Contact the author(s)."

test: @TEST@

install: all @INSTALL_LIB@ @INSTALL_DOC@ @INSTALL_BIN@ @INSTALL_EXA@ @INSTALL_DAT@ @INSTALL_EXTRA@

install-bin-lib: install-lib

install-script-lib: install-lib

install-lib:
	@$(P) 'Installing %s files in %s\n' lib $(DESTDIR)${PKG_INSTALL_DIR}/
	@$(INSTALL_DATA_DIR) $(DESTDIR)${PKG_INSTALL_DIR}
	@$(EN) $(INDENT)
	@$(EN) "${LIB} "
	@$(INSTALL_LIBRARY) ${LIBDIR}${LIB} $(DESTDIR)${PKG_INSTALL_DIR}
	@if test X"@PKGINDEX@" != X"" ; then \
	    $(EN) "@PKGINDEX@"; \
	    $(INSTALL_DATA) @PKGINDEX@ $(DESTDIR)${PKG_INSTALL_DIR}; \
	fi
	@$(E) ''

install-script-bin:
	@$(P) 'Installing %s files in %s\n' 'script bin' $(DESTDIR)${bindir}/
	@$(INSTALL_DATA_DIR) $(DESTDIR)${bindir}
	@$(EN) $(INDENT)
	@list='${SCBIN}'; \
	for p in $$list; do \
	    $(EN) "$$p "; \
	    $(INSTALL_SCRIPT) $$p $(DESTDIR)${bindir}; \
	done
	@$(E) ''

install-doc:
	@$(P) 'Installing %s files in %s\n' doc $(DESTDIR)${DOC_INSTALL_DIR}/
	@$(INSTALL_DATA_DIR) $(DESTDIR)${DOC_INSTALL_DIR}
	@$(EN) $(INDENT)
	@list='${DOC}'; \
	for p in $$list; do \
	    $(EN) "$$p "; \
	    $(INSTALL_DATA) $$p $(DESTDIR)${DOC_INSTALL_DIR}; \
	done
	@$(E) ''

install-exa:
	@$(P) 'Installing %s files in %s\n' example $(DESTDIR)${exadir}/
	@$(INSTALL_DATA_DIR) $(DESTDIR)${exadir}
	@$(EN) $(INDENT)
	@DIR=examples; \
	list='@EXA@'; \
	for p in $$list; do \
	    $(EN) "$$p "; \
	    if test -x ${srcdir}/$$DIR/$$p; then \
		$(INSTALL_SCRIPT) ${srcdir}/$$DIR/$$p $(DESTDIR)${exadir}; \
	    else \
		$(INSTALL_DATA) ${srcdir}/$$DIR/$$p $(DESTDIR)${exadir}; \
	    fi; \
	done
	@$(E) ''

install-dat:
	@$(P) 'Installing %s files in %s\n' dat $(DESTDIR)${datdir}/
	@$(INSTALL_DATA_DIR) $(DESTDIR)${datdir}
	@$(EN) $(INDENT)
	@DIR="@DAT_DIR@"; \
	list='@DAT_FILES@'; \
	for p in $$list; do \
	    op=$$p; \
	    p=$$DIR/$$p; \
	    DDIR=`dirname $$p`; \
	    if ! test -d $(DESTDIR)${datdir}/$$DDIR; then \
		$(INSTALL_DATA_DIR) $(DESTDIR)${datdir}/$$DDIR; \
	    fi; \
	    $(EN) "$$op "; \
	    $(INSTALL_DATA) ${srcdir}/$$p $(DESTDIR)${datdir}/$$DDIR/; \
	done
	@$(E) ''

print-dist-name:
	@$(E) $(DIST_NAME)

dist: dist-clean dist-setup @DIST@ dist-compress

dist-clean:
	rm -rf $(DIST_DIR) $(DIST_ROOT)/$(DIST_FILE)

dist-setup:
	$(INSTALL_DATA_DIR) $(DIST_DIR)

dist-compress:
	tar zcvf $(DIST_ROOT)/$(DIST_FILE) -C $(DIST_ROOT) $(DIST_NAME)

dist-spot:
	list='LICENSE README README.licenses Makefile.in spoto.conf @EXT_CONF_FILES@'; \
	for p in $$list; do \
	    $(DIST_INSTALL_DATA) ${srcdir}/$$p $(DIST_DIR)/; \
	done
	$(DIST_INSTALL_SCRIPT) ${srcdir}/configure $(DIST_DIR)/
	$(INSTALL_DATA_DIR) $(DIST_DIR)/tclconfig
	DIR=tclconfig; \
	list='install-sh'; \
	for p in $$list; do \
	    $(DIST_INSTALL_DATA) ${srcdir}/$$DIR/$$p $(DIST_DIR)/$$DIR/; \
	done
	list='Makefile.portobsd.in'; \
	for p in $$list; do \
	    if test -f ${srcdir}/$$p; then \
		$(DIST_INSTALL_DATA) ${srcdir}/$$p $(DIST_DIR)/; \
	    fi; \
	done

dist-ext: dist-spot
	list='RELEASE Makefile.${NAME}.in UNLICENSE'; \
	for p in $$list; do \
	    if test -f ${srcdir}/$$p; then \
		$(DIST_INSTALL_DATA) ${srcdir}/$$p $(DIST_DIR)/; \
	    fi; \
	done
	DIR=library; \
	list='${SCLIBSRC}'; \
	if test -d ${srcdir}/$$DIR; then \
	    $(INSTALL_DATA_DIR) $(DIST_DIR)/$$DIR; \
	    for p in $$list; do \
		$(DIST_INSTALL_DATA) ${srcdir}/$$DIR/$$p $(DIST_DIR)/$$DIR/; \
	    done; \
	fi
	DIR=library; \
	list='pkgIndex.tcl'; \
	if test -d ${srcdir}/$$DIR; then \
	    $(INSTALL_DATA_DIR) $(DIST_DIR)/$$DIR; \
	    for p in $$list; do \
		if test -f ${srcdir}/$$DIR/$$p; then \
		    $(DIST_INSTALL_DATA) ${srcdir}/$$DIR/$$p $(DIST_DIR)/$$DIR/; \
		fi; \
	    done; \
	fi
	DIR=bin; \
	list='${SCBINSRC}'; \
	if test -d ${srcdir}/$$DIR; then \
	    $(INSTALL_DATA_DIR) $(DIST_DIR)/$$DIR; \
	    for p in $$list; do \
	        $(DIST_INSTALL_SCRIPT) ${srcdir}/$$DIR/$$p $(DIST_DIR)/$$DIR/; \
	    done; \
	fi
	DIR=doc; \
	list='${NAME}.man ${NAME}.n ${NAME}.html'; \
	if test -d ${srcdir}/$$DIR; then \
	    $(INSTALL_DATA_DIR) $(DIST_DIR)/$$DIR; \
	    for p in $$list; do \
		$(DIST_INSTALL_DATA) ${srcdir}/$$DIR/$$p $(DIST_DIR)/$$DIR/; \
	    done; \
	fi
	DIR=tests; \
	list='${TESTFWK} ${PKG_NAME}.test'; \
	if test X"@TEST@" != X"" && test -d ${srcdir}/$$DIR; then \
	    $(INSTALL_DATA_DIR) $(DIST_DIR)/$$DIR; \
	    for p in $$list; do \
		$(DIST_INSTALL_DATA) ${srcdir}/$$DIR/$$p $(DIST_DIR)/$$DIR/; \
	    done; \
	fi
	DIR=examples; \
	list='@EXA@'; \
	if test -d ${srcdir}/$$DIR; then \
	    $(INSTALL_DATA_DIR) $(DIST_DIR)/$$DIR; \
	    for p in $$list; do \
		if test -x ${srcdir}/$$DIR/$$p; then \
		    $(DIST_INSTALL_SCRIPT) ${srcdir}/$$DIR/$$p $(DIST_DIR)/$$DIR/; \
		else \
		    $(DIST_INSTALL_DATA) ${srcdir}/$$DIR/$$p $(DIST_DIR)/$$DIR/; \
		fi; \
	    done; \
	fi
	DIR='${DAT_DIR}'; \
	list='${DAT_FILES}'; \
	for p in $$list; do \
	    op=$$p; \
	    p=$$DIR/$$p; \
	    DDIR=`dirname $$p`; \
	    if ! test -d ${srcdir}/$$DDIR; then continue; fi; \
	    if ! test -d $(DIST_DIR)/$$DDIR; then \
		$(INSTALL_DATA_DIR) $(DIST_DIR)/$$DDIR; \
	    fi; \
	    $(DIST_INSTALL_DATA) ${srcdir}/$$p $(DIST_DIR)/$$DDIR/; \
	done
	DIR=thatch; \
	list='mkthatch'; \
	if test -d ${srcdir}/$$DIR; then \
	    $(INSTALL_DATA_DIR) $(DIST_DIR)/$$DIR; \
	    for p in $$list; do \
		$(DIST_INSTALL_DATA) ${srcdir}/$$DIR/$$p $(DIST_DIR)/$$DIR/; \
	    done; \
	fi

dist-check:
	@diff -urq $(DIST_DIR) ${srcdir} || :

# @EXT_MK@

.PHONY: all reconfigure configure dist clean distclean @DIST@ @INSTALL_EXTRA@
.PHONY: shell test install install-lib install-doc install-exa install-dat
.PHONY: test-Tcl test-Jim no-test
.PHONY: dist-clean dist-start dist-compress dist-spot dist-ext
.PHONY: result thatch dist-check print-dist-name
.PHONY: @CLEAN@ @DISTCLEAN@

# Spot o' Conf 0.9

# EOF
